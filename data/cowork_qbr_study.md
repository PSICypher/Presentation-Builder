# CoWork QBR Reference Material Study

> Generated by pb-ba2 study task. This document captures all findings from
> analyzing the CoWork QBR reference material, for use by downstream beads.

## 1. Project Goal

Build a repeatable tool that takes **raw data files + a PowerPoint template** and
generates a formatted, data-accurate presentation. The key principle: each month
tells its own story — never recycle narratives or data.

**Three-layer architecture:**
1. **Template Analyzer** (`src/analyzer/`) — Extracts structure from PPTX into machine-readable schema
2. **Data Processor** (`src/processor/`) — Ingests CSV/Excel, calculates metrics, maps to template slots
3. **Presentation Generator** (`src/generator/`) — Combines schema + data payload to produce output PPTX

---

## 2. Reference Material Location

| Resource | Path |
|----------|------|
| Vision document | `/Users/merwes/CLAUDE/CoWork/QBRs/Vision.md` |
| Ingenuity QBR skill | `/Users/merwes/CLAUDE/CoWork/QBRs/ingenuity-qbr.skill` (zip) |
| QBR template (Ingenuity) | `.../ingenuity-qbr/assets/qbr-template.pptx` |
| Ingenuity QBR Template | `/Users/merwes/CLAUDE/CoWork/QBRs/Ingenuity - QBR Template.pptx` |
| Pevonia QBR example | `/Users/merwes/CLAUDE/CoWork/QBRs/Pevonia QBR 2025 Q4.pptx` |
| December 2025 report | `.../No7/FY26/Reports/04.December 2025/...pptx` |
| January 2026 report | `.../No7/FY26/Reports/05.January 2026/...pptx` |
| ATTEMPT1 (January) | `/Users/merwes/CLAUDE/CoWork/QBRs/No7 US January 2026 Report_ATTEMPT1.pptx` |
| ATTEMPT2 (January) | `/Users/merwes/CLAUDE/CoWork/QBRs/No7 US x THGi Monthly eComm Report - January 2026 Overview_ATTEMPT2.pptx` |
| Internal Tracker (Jan) | `.../No7/FY26/Int. Performance Tracker/05.January 2026/January 2026 No7 Internal Tracker.xlsx` |
| Product Sales CSV | `/Users/merwes/CLAUDE/CoWork/QBRs/Product Sales Report No7 US Q4.csv` |
| Offer Performance CSV | `/Users/merwes/CLAUDE/CoWork/QBRs/Offer Performance No7 US Q4.csv` |

---

## 3. Data Sources & Formats

### 3.1 CSV Files (UTF-16 Encoded, Tab-Delimited)

**CRITICAL:** Both CSV files use **UTF-16 encoding** with **tab delimiters**.
Standard CSV readers must specify `encoding='utf-16'` and `delimiter='\t'`.

#### Product Sales Report (69 columns, 8,236 rows)
- **Dimensions:** Product Name (153 unique), Month (10/11/12), Day (1-31)
- **22 metric triplets**, each with `(Analysis)`, `(Comparison)`, `(vs. Comp)`:
  Units, Orders, AOV, Product Revenue, Shipping Revenue, Total Revenue,
  Avg Items Per Order, Avg Selling Price, Unique Products Sold,
  New/Returning/Total Customers, Markdown/%, Promo Discount/%,
  Total Discount/%, Discounted Units/%, Discounted Product Revenue/%
- Values are comma-formatted numbers; percentage changes use "ppts" suffix

#### Offer Performance (10 columns, 7,122 rows)
- **Dimensions:** Offer Name (247 unique), Channel (13: AFFILIATE, DIRECT,
  DISPLAY, EMAIL, INTERNAL REFERRAL, ORGANIC, OTHER, PAID SOCIAL, PPC,
  REFERRAL, SEO, SOCIAL), Month, Day
- **Metrics:** Redemptions, Revenue, Discount Amount (each with % Change)

### 3.2 Internal Performance Tracker (XLSX)

Consistent 16-sheet structure across all months:

| Sheet | Purpose | Typical Size |
|-------|---------|-------------|
| MTD Reporting | Primary monthly dashboard | 54 rows x 38-42 cols |
| Daily | Day-by-day performance | 70 rows x 25-32 cols |
| YTD | Year-to-date cumulative | 87 rows x 24 cols |
| Channel Deep Dive | Per-channel analysis | 15 rows x 9 cols |
| RAW DATA | Raw transactional data | ~25,775 rows x 19-23 cols |
| Data Dump | Aggregated export | 117 rows x 45-48 cols |
| Warehouse Forecast | Inventory forecast | 335 rows x 10 cols |
| Manual update- Daily Target | Daily targets | 1,128 rows x 10 cols |
| Manual update- Channel Targets | Channel targets | 45-449 rows x 38 cols |
| YTD Targets | Annual targets | 10 rows x 3 cols |
| Last Week / This week | Weekly snapshots | Small |
| IGNORE / Sheet1/2 / N | Scratch/deprecated | Small |

**Key channels in tracker:** EMAIL, AFFILIATE, PPC, ORGANIC, DIRECT, SOCIAL, DISPLAY

**Gap:** December 2025 tracker is **missing** (empty folder).

### 3.3 Available Metrics from Tracker

From Vision.md, available in tracker:
- Revenue by channel (EMAIL, AFFILIATE, PPC, ORGANIC, DIRECT, SOCIAL, DISPLAY)
- Orders, Sessions, New Customers
- Cost data for COS calculations
- YoY comparisons

**NOT available in tracker:**
- Promotion/offer-level redemption data (use Offer Performance CSV)
- SKU/product-level sales (use Product Sales Report CSV)
- Email campaign performance breakdown (use CRM Q4 file)
- Affiliate partner breakdown (use Affiliate Q4 file)

---

## 4. PPTX Template Structure

### 4.1 Two Report Types

| Type | Slide Size | Template |
|------|-----------|----------|
| Monthly eComm Report | 13.33" x 7.50" (standard 16:9) | THGi-branded layouts |
| Quarterly Business Review | 21.99" x 12.37" (oversized 16:9) | Ingenuity-branded layouts |

### 4.2 Common Design Elements

- **Primary font:** DM Sans (all files)
- **Brand blue:** #0065E0 / #0065E2 / #0064E0 (slight variations)
- **Color palette:** Black (#000000), Blue (#0065E2), Dark blue-gray (#0C2631/#1C2B33),
  White (#FFFFFF), Green (#92D050/#00B050), Red (#FF0000), Orange (#E15B1F)
- **Layout:** "Title Only" used for 95%+ of slides — shapes placed manually, not via placeholders
- **Construction:** Almost entirely manually-placed shapes (auto shapes + text boxes)
  rather than layout placeholders (only 1-2 placeholders per file)

### 4.3 Chart Types Used

| Chart Type | Purpose | Data Pattern |
|------------|---------|-------------|
| DOUGHNUT | KPI progress gauges (achieved vs target) | 2-4 data points: [achieved%, remaining%] |
| DOUGHNUT_EXPLODED | Variant KPI gauge | Same as DOUGHNUT with explosion |
| COLUMN_CLUSTERED | Revenue/performance bars | 2-3 series (Actual, Target, COS%) x monthly categories |
| LINE | Trend data (signups over time) | Single series x 12 monthly categories |

**Chart details for Column Clustered:**
- Daily Performance: 3 series x 31 days (Actual Revenue, Target Revenue, YoY %)
- Monthly Revenue: 2-3 series x 9-12 months (Revenue LY, Revenue TY, COS%)
- ROAS/AOV comparisons: 1 series x 2 categories (2024, 2025)

**Chart details for Doughnut (KPI gauges):**
- Typically 2 data points: `[achieved_value, remaining_to_target]`
- Categories: `['Achieved', 'Target']` or `['1st Qtr', '2nd Qtr', '3rd Qtr', '4th Qtr']`
- No legends, no titles (labels added via separate text boxes)

### 4.4 Monthly eComm Report Structure (14 slides)

| Slide | Content | Key Elements |
|-------|---------|-------------|
| 1 | Cover + KPIs | Revenue, Orders, AOV, NC, CVR, COS headline numbers |
| 2 | Table of Contents | Static section list |
| 3 | Section Divider | Blue background, white text |
| 4 | Executive Summary / eComm Performance | Performance table (9 rows), channel breakdown, narrative |
| 5 | Daily Performance | Daily chart + campaign table |
| 6 | Promotion Performance | Promotion redemption table |
| 7 | Product Performance | Top 15 products table |
| 8 | Section Divider | Blue background |
| 9 | CRM Performance | CRM metrics, top send, channel detail |
| 10 | Affiliate Performance | Top publishers, exclusive offers |
| 11 | SEO Performance | Organic revenue, sessions, top pages |
| 12 | Section Divider | Blue background |
| 13 | Upcoming Promotions | Promotion calendar table |
| 14 | Next Steps | Action items and owners |

### 4.5 QBR Report Structure (22-36 slides)

Includes all monthly report sections plus:
- Strategy Review (4-pillar grid)
- Quarter Successes & Challenges
- Customer Service Overview
- Fulfilment Overview
- Quarter Lookahead
- Key Projects / Roadmap
- Growth Opportunities
- Platform Roadmap
- Critical Path Planning

### 4.6 Shape Counts (Monthly eComm Report)

December 2025 report: 74 total shapes
- 24 text boxes, 21 pictures, 15 auto shapes, 9 tables, 3 freeforms,
  1 chart, 1 placeholder

Slides are **table-heavy** (9 tables in 14 slides) — most data is in tables, not charts.

---

## 5. Lessons from ATTEMPT1 and ATTEMPT2

### 5.1 ATTEMPT1 Issues
- **Text content was 100% correct** (identical to final)
- **Wrong file naming convention**: Used "No7 US January 2026 Report" instead of
  "No7 US x THGi Monthly eComm Report - January 2026 Overview"
- Files are byte-identical (10,636,088 bytes) — the fix was purely the filename

### 5.2 ATTEMPT2 Issues (28 differences across 8 slides)

**Critical failure patterns:**

1. **Recycled December data:** Performance table on Slide 4 contained December's
   exact figures ($362,363 revenue) while narrative said "January"

2. **Hallucinated promotion names:** "Cyber Monday" systematically replaced with
   "MLK Weekend" across 5 slides — AI tried to contextualize December promotions
   for January, but the actual data used original promotion names

3. **Fabricated adjusted numbers:** CRM revenue shown as $85.9K (actual: $178.5K),
   SEO revenue shown as $11.2K (actual: $25.5K) — AI scaled December numbers
   proportionally rather than using actual data

4. **Missing data replaced with N/A:** Both promotion redemption table (19 rows)
   and product Top 15 table (16 rows) replaced with single "N/A" placeholder rows

5. **Wrong YoY direction:** Headline showed -20% YoY instead of +1% YoY —
   completely misrepresents performance direction

6. **Recycled narrative:** December's success story ("overachieved target by +$26K")
   kept even though January came in $10K below target

7. **Wrong affiliate YoY:** Capital One shown as +8% YoY (December) instead of -5% YoY

### 5.3 Rules for the Presentation Builder

Based on these failures, the tool MUST:

1. **Never fabricate data** — only use actual values from source files
2. **Never rename promotions** — use exact names from data source
3. **Separate template (reusable) from data (must refresh each month)**
4. **Validate month references** in text match the report month
5. **Flag N/A cells** for human review
6. **Cross-check headline KPIs** against detailed table data
7. **Compare YoY direction signs** across narrative and tables
8. **Never carry forward data tables** from previous months without explicit refresh
9. **Use approved naming convention:** "No7 US x THGi Monthly eComm Report - [Month Year] Overview.pptx"

---

## 6. Design Guidelines (from skill reference)

### Color Palette (Ingenuity Brand)
| Element | Hex |
|---------|-----|
| Primary Blue | #0066CC |
| Dark Blue (headers) | #003366 |
| White | #FFFFFF |
| Light Gray (backgrounds) | #F5F5F5 |
| Accent positive | #00AA00 |
| Accent negative | #CC0000 |

### Typography
- Titles: DM Sans Bold, 36-44pt
- Section headers: Bold, 24-28pt
- Body text: 14-16pt
- KPI numbers: Bold, 48-60pt
- KPI labels: 12-14pt, muted

### Formatting Rules
- Currency: Under $1K = `$XXX`, $1K-$999K = `$XXXk`, $1M+ = `$X.Xm`
- Percentages: Rates = `X.X%`, Variances = `+X.X%`/`-X.X%`, Points = `+X.X ppts`
- Numbers: Under 1K = `XXX`, 1K-999K = `X,XXX`/`XXXk`, 1M+ = `X.Xm`
- Positive variance: Green text
- Negative variance: Red text

---

## 7. Workflow for Report Generation

1. **Locate the tracker** for the target month
2. **Extract key metrics** using pandas/openpyxl
3. **Identify the story** — growth? decline? mixed?
4. **Check for supplementary data** (CRM, Affiliate, Offer, Product files)
5. **Create report** from previous month template
6. **Update ALL values and narrative** to reflect new data
7. **Mark unavailable data** as N/A
8. **Run similarity check** against previous month (target: <80%)
9. **Save with correct naming convention**

---

## 8. Key Technical Decisions for Builder

### Data Ingestion (pb-0hq needs)
- Must handle UTF-16 encoded CSV with tab delimiters
- Must handle XLSX with 16 sheets, complex formulas, ~25K raw data rows
- Key sheets to parse: MTD Reporting, Daily, Channel Deep Dive, RAW DATA
- Must extract both actual values and target values for variance calculation

### Template Schema (pb-cwv needs)
- Monthly report uses standard 13.33" x 7.50" slide size
- 14-slide fixed structure with mostly "Title Only" layout
- Shapes are manually placed (not placeholders) — need coordinate-based mapping
- 9 tables per report — table-driven, not chart-driven
- 1 chart (daily column clustered) with 31 data points
- Multiple doughnut charts for KPI gauges
- Font: DM Sans exclusively in monthly reports
- Color scheme: #0064E0 (blue), #000000 (black), #D1D5DB (light gray)

### Mapping Config (pb-m46 needs)
- Each slide maps to specific data sources and sheets
- Cover slide KPIs from MTD Reporting totals
- Performance table from MTD Reporting with target comparisons
- Daily chart from Daily sheet (31 days x 2-3 series)
- Promotion table from Offer Performance CSV
- Product table from Product Sales Report CSV
- Channel slides (CRM, Affiliate, SEO) from Channel Deep Dive + supplementary files
- Upcoming promotions from manual input or calendar data

---

## 9. Calculated Fields

| Calculation | Formula |
|-------------|---------|
| Variance vs Target | `(Actual - Target) / Target * 100` |
| Variance vs LY (YoY) | `(Actual - LY) / LY * 100` |
| ROAS | `Revenue / Spend` |
| COS | `Spend / Revenue` |
| Contribution % | `Channel Revenue / Total Revenue * 100` |

---

## 10. Missing Data Handling

1. **Missing target:** Show actual only, note "Target N/A"
2. **Missing LY comparison:** Show QoQ instead if available
3. **Missing channel data:** Exclude that channel's slide
4. **Missing month:** Note gap, don't interpolate
5. **Always flag missing data** before proceeding
